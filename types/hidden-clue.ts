/**
 * ═══════════════════════════════════════════════════════════════════════════
 * HIDDEN CLUE SYSTEM TYPES
 * Система скрытых улик — видны только после обнаружения
 * ═══════════════════════════════════════════════════════════════════════════
 */

// ═══════════════════════════════════════════════════════════════════════════
// CLUE STATE
// ═══════════════════════════════════════════════════════════════════════════

export type ClueState = 
  | "hidden"      // Не видна — игрок не в нужной панораме или не смотрит туда
  | "hinted"      // Мягкая подсказка — вибрация/звук, но маркера нет
  | "revealing"   // Игрок смотрит в нужную сторону, идёт dwellTime
  | "revealed"    // Обнаружена! Маркер виден, можно кликнуть
  | "collected";  // Собрана

// ═══════════════════════════════════════════════════════════════════════════
// HIDDEN CLUE
// ═══════════════════════════════════════════════════════════════════════════

export interface HiddenClue {
  id: string;
  
  // ─── Локация ───
  /** ID панорамы Google Street View где находится улика */
  panoId: string;
  
  /** Направление камеры для обнаружения (градусы 0-360) */
  revealHeading: number;
  
  /** Ширина конуса обнаружения (градусы, обычно 60-120) */
  coneDegrees: number;
  
  /** Сколько секунд нужно смотреть чтобы обнаружить (0.5-2) */
  dwellTime: number;
  
  // ─── Контент ───
  /** Название улики */
  name: string;
  
  /** Описание (показывается после сбора) */
  description: string;
  
  /** Иконка */
  icon: string;
  
  /** Контекст истории — что это значит для расследования */
  storyContext: string;
  
  /** XP за сбор */
  xpReward: number;
  
  // ─── Подсказки ───
  /** Мягкая подсказка когда игрок в нужной панораме (но не смотрит туда) */
  hintText?: string;
  
  /** Подсказка сканера (раз в 30 сек) */
  scannerHint?: string;
}

// ═══════════════════════════════════════════════════════════════════════════
// CLUE RUNTIME STATE
// ═══════════════════════════════════════════════════════════════════════════

export interface ClueRuntimeState {
  clueId: string;
  state: ClueState;
  
  /** Сколько секунд игрок уже смотрит в нужную сторону */
  dwellProgress: number;
  
  /** Время обнаружения */
  revealedAt?: Date;
  
  /** Время сбора */
  collectedAt?: Date;
}

// ═══════════════════════════════════════════════════════════════════════════
// MISSION WITH HIDDEN CLUES
// ═══════════════════════════════════════════════════════════════════════════

export interface HiddenClueMission {
  id: string;
  title: string;
  description: string;
  briefing: string;
  
  // ─── Стартовая точка ───
  startPanoId: string;
  startHeading: number;
  
  // ─── Улики ───
  clues: HiddenClue[];
  
  /** Минимум улик для прохождения */
  requiredClues: number;
  
  // ─── Время и награды ───
  timeLimit?: number;
  xpReward: number;
  
  // ─── Мета ───
  location: string;
  difficulty: "easy" | "medium" | "hard" | "extreme";
  icon: string;
  color: string;
}

// ═══════════════════════════════════════════════════════════════════════════
// DISCOVERY EVENT
// ═══════════════════════════════════════════════════════════════════════════

export interface ClueDiscoveryEvent {
  type: "hint" | "revealing" | "revealed" | "collected";
  clue: HiddenClue;
  timestamp: Date;
}

