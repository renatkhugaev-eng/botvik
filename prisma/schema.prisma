generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         Int           @id @default(autoincrement())
  telegramId String        @unique
  username   String?
  firstName  String?
  lastName   String?
  photoUrl   String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  
  // XP System
  xp              Int       @default(0)      // Total experience points
  lastQuizAt      DateTime?                  // Last quiz completion (for daily bonus tracking)
  
  // Daily Rewards System
  dailyRewardStreak   Int       @default(0)      // Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ´Ğ½ĞµĞ¹ (1-7, ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ 7)
  lastDailyRewardAt   DateTime?                  // ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ· Ğ·Ğ°Ğ±Ñ€Ğ°Ğ» Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñƒ
  
  // Bonus Energy System (from Daily Rewards)
  bonusEnergy         Int       @default(0)      // Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ±Ğ¾Ğ½ÑƒÑĞ½Ğ¾Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸
  bonusEnergyEarned   Int       @default(0)      // Ğ’ÑĞµĞ³Ğ¾ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹)
  bonusEnergyUsed     Int       @default(0)      // Ğ’ÑĞµĞ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹)
  
  // Notification Preferences
  notifyLevelUp       Boolean   @default(true)   // Level up notifications
  notifyEnergyFull    Boolean   @default(true)   // Energy restored notifications
  notifyDailyReminder Boolean   @default(true)   // Daily play reminder
  notifyLeaderboard   Boolean   @default(false)  // Leaderboard changes
  notifyFriends       Boolean   @default(true)   // Friend activity
  lastNotifiedAt      DateTime?                  // Last notification sent (rate limiting)
  
  sessions   QuizSession[]
  leaderboardEntries LeaderboardEntry[]
  
  // Weekly competition
  weeklyScores  WeeklyScore[]
  weeklyWins    WeeklyWinner[]
  
  // Friends relationships
  friendsAdded    Friendship[] @relation("FriendshipUser")
  friendsReceived Friendship[] @relation("FriendshipFriend")
  
  // Chat messages
  chatMessages    ChatMessage[]
  
  // Achievements
  achievements    UserAchievement[]
  
  // Referral System
  referralCode    String?   @unique  // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ (Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ)
  referredById    Int?               // ĞšÑ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ğ» ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  referredBy      User?     @relation("ReferralRelation", fields: [referredById], references: [id])
  referrals       User[]    @relation("ReferralRelation")  // ĞšĞ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ğ» ÑÑ‚Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
  
  // Tournaments
  tournamentParticipations TournamentParticipant[]
  tournamentStageResults   TournamentStageResult[]
  tournamentPrizes         TournamentPrize[]
  
  // Cosmetics Shop
  equippedFrameId Int?
  equippedFrame   CosmeticItem? @relation("EquippedFrame", fields: [equippedFrameId], references: [id])
  inventory       UserInventory[]
  purchases       Purchase[]
}

model Friendship {
  id        Int              @id @default(autoincrement())
  userId    Int              // ĞšÑ‚Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ» Ğ·Ğ°ÑĞ²ĞºÑƒ
  friendId  Int              // ĞšĞ¾Ğ¼Ñƒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»
  status    FriendshipStatus @default(PENDING)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @default(now()) @updatedAt
  
  user   User @relation("FriendshipUser", fields: [userId], references: [id])
  friend User @relation("FriendshipFriend", fields: [friendId], references: [id])
  
  @@unique([userId, friendId])
  @@index([userId])
  @@index([friendId])
  @@index([status])
}

enum FriendshipStatus {
  PENDING   // ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
  ACCEPTED  // ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ°
  DECLINED  // ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ°
}

model Quiz {
  id               Int            @id @default(autoincrement())
  title            String
  description      String?
  isActive         Boolean        @default(true)
  startsAt         DateTime?
  endsAt           DateTime?
  prizeTitle       String
  prizeDescription String?
  questions        Question[]
  sessions         QuizSession[]
  leaderboardEntries LeaderboardEntry[]
  
  // Tournament stages that use this quiz
  tournamentStages TournamentStage[]
}

model Question {
  id               Int             @id @default(autoincrement())
  quizId           Int
  text             String
  order            Int
  timeLimitSeconds Int?
  difficulty       Int             @default(1) // 1 = Ğ»ĞµĞ³ĞºĞ¸Ğ¹, 2 = ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹, 3 = ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹
  quiz             Quiz            @relation(fields: [quizId], references: [id])
  answers          AnswerOption[]
  responses        Answer[]        @relation("QuestionResponses")
}

model AnswerOption {
  id         Int       @id @default(autoincrement())
  questionId Int
  text       String
  isCorrect  Boolean   @default(false)
  question   Question  @relation(fields: [questionId], references: [id])
  answers    Answer[]
}

model QuizSession {
  id                       Int       @id @default(autoincrement())
  userId                   Int
  quizId                   Int
  startedAt                DateTime  @default(now())
  finishedAt               DateTime?
  totalScore               Int       @default(0)
  attemptNumber            Int       @default(1) // ĞĞ¾Ğ¼ĞµÑ€ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ĞºĞ²Ğ¸Ğ·Ğ°
  currentQuestionIndex     Int       @default(0) // Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° (0-based)
  currentQuestionStartedAt DateTime? // ĞšĞ¾Ğ³Ğ´Ğ° Ğ±Ñ‹Ğ» Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ (server-side)
  currentStreak            Int       @default(0) // Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (server-side)
  maxStreak                Int       @default(0) // ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ·Ğ° ÑĞµÑÑĞ¸Ñ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹)
  user                     User      @relation(fields: [userId], references: [id])
  quiz                     Quiz      @relation(fields: [quizId], references: [id])
  answers                  Answer[]
  
  @@index([userId, quizId])
}

model Answer {
  id          Int           @id @default(autoincrement())
  sessionId   Int
  questionId  Int
  optionId    Int?          // Nullable for timeout (no answer selected)
  isCorrect   Boolean
  timeSpentMs Int
  scoreDelta  Int
  isTimeout   Boolean       @default(false) // Flag for timeout answers
  createdAt   DateTime      @default(now())
  session     QuizSession   @relation(fields: [sessionId], references: [id])
  question    Question      @relation("QuestionResponses", fields: [questionId], references: [id])
  option      AnswerOption? @relation(fields: [optionId], references: [id])
  
  @@unique([sessionId, questionId]) // Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ½Ğ° Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ
  @@index([sessionId])
}

model LeaderboardEntry {
  id         Int      @id @default(autoincrement())
  userId     Int
  quizId     Int
  periodType String
  bestScore  Int      @default(0)  // Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ·Ğ° Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ³Ñ€Ñƒ
  attempts   Int      @default(1)  // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])
  quiz       Quiz     @relation(fields: [quizId], references: [id])

  @@unique([userId, quizId, periodType])
  @@index([quizId, periodType, bestScore])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEEKLY COMPETITION SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Weekly scores - resets every Sunday at 23:59
model WeeklyScore {
  id        Int      @id @default(autoincrement())
  userId    Int
  weekStart DateTime // Monday 00:00 of the week
  bestScore Int      @default(0)  // Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ·Ğ° Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ³Ñ€Ñƒ Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ğµ
  quizzes   Int      @default(0)  // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ğ³Ñ€ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, weekStart])
  @@index([weekStart, bestScore])
}

// Archive of weekly winners
model WeeklyWinner {
  id        Int      @id @default(autoincrement())
  userId    Int
  weekStart DateTime // Monday 00:00 of the week
  weekEnd   DateTime // Sunday 23:59 of the week
  place     Int      // 1, 2, or 3
  score     Int
  prize     String?  // Prize description
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@unique([weekStart, place])
  @@index([userId])
  @@index([weekStart])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBAL CHAT SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model ChatMessage {
  id        Int      @id @default(autoincrement())
  userId    Int
  text      String   @db.VarChar(500) // ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 500 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id])
  
  @@index([createdAt(sort: Desc)]) // Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
  @@index([userId])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOURNAMENTS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Tournament {
  id            Int       @id @default(autoincrement())
  slug          String    @unique              // URL-friendly ID: "serial-killers-60s"
  title         String                         // "Ğ¡ĞµÑ€Ğ¸Ğ¹Ğ½Ğ¸ĞºĞ¸ 60-Ñ…"
  description   String?
  icon          String    @default("âš”ï¸")       // Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸ĞºĞ¾Ğ½ĞºĞ°
  coverImage    String?                        // URL Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸
  gradientFrom  String    @default("#2d132c")  // Ğ¦Ğ²ĞµÑ‚ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ° (Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾)
  gradientTo    String    @default("#1a1a2e")  // Ğ¦Ğ²ĞµÑ‚ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ° (ĞºĞ¾Ğ½ĞµÑ†)
  
  // Ğ’Ñ€ĞµĞ¼Ñ
  startsAt      DateTime
  endsAt        DateTime
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  status        TournamentStatus @default(UPCOMING)
  
  // ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
  minPlayers    Int       @default(3)          // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ğ´Ğ»Ñ Ñ€Ğ¾Ğ·Ñ‹Ğ³Ñ€Ñ‹ÑˆĞ°
  maxPlayers    Int?                           // null = Ğ±ĞµĞ·Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
  entryFee      Int       @default(0)          // Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² XP (0 = Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)
  
  // Ğ¢Ğ¸Ğ¿ Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğ°
  type          TournamentType @default(QUIZ)
  
  // Ğ¡Ğ²ÑĞ·Ğ¸
  stages        TournamentStage[]
  participants  TournamentParticipant[]
  prizes        TournamentPrize[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([status])
  @@index([startsAt])
  @@index([endsAt])
}

enum TournamentStatus {
  DRAFT       // Ğ§ĞµÑ€Ğ½Ğ¾Ğ²Ğ¸Ğº (Ğ½Ğµ Ğ²Ğ¸Ğ´ĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼)
  UPCOMING    // Ğ¡ĞºĞ¾Ñ€Ğ¾ Ğ½Ğ°Ñ‡Ğ½Ñ‘Ñ‚ÑÑ
  ACTIVE      // Ğ˜Ğ´Ñ‘Ñ‚ ÑĞµĞ¹Ñ‡Ğ°Ñ
  FINISHED    // Ğ—Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½
  CANCELLED   // ĞÑ‚Ğ¼ĞµĞ½Ñ‘Ğ½
}

enum TournamentType {
  QUIZ           // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ²Ğ¸Ğ·Ñ‹
  INVESTIGATION  // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)
  MIXED          // Ğ¡Ğ¼ĞµÑˆĞ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)
}

// â•â•â• Ğ­Ğ¢ĞĞŸĞ« Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ â•â•â•
model TournamentStage {
  id            Int       @id @default(autoincrement())
  tournamentId  Int
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  order         Int                            // ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº ÑÑ‚Ğ°Ğ¿Ğ° (1, 2, 3...)
  title         String                         // "ĞšĞ²Ğ°Ğ»Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ", "Ğ¤Ğ¸Ğ½Ğ°Ğ»"
  description   String?
  type          StageType  @default(QUIZ)
  
  // Ğ’Ñ€ĞµĞ¼Ñ ÑÑ‚Ğ°Ğ¿Ğ° (ĞµÑĞ»Ğ¸ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğ°)
  startsAt      DateTime?
  endsAt        DateTime?
  
  // ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
  quizId        Int?                           // Ğ¡Ğ²ÑĞ·ÑŒ Ñ ĞºĞ²Ğ¸Ğ·Ğ¾Ğ¼
  quiz          Quiz?      @relation(fields: [quizId], references: [id])
  
  // ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
  topN          Int?                           // Ğ¢Ğ¾Ğ¿-N Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚ Ğ´Ğ°Ğ»ÑŒÑˆĞµ (null = Ğ²ÑĞµ)
  minScore      Int?                           // ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ» Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ°
  
  // ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‡ĞºĞ¾Ğ² Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ğ¿Ğ°
  scoreMultiplier Float    @default(1.0)       // 1.0 = Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ğ¾Ñ‡ĞºĞ¸, 2.0 = Ğ´Ğ²Ğ¾Ğ¹Ğ½Ñ‹Ğµ
  
  // Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
  results       TournamentStageResult[]
  
  @@unique([tournamentId, order])
  @@index([tournamentId])
  @@index([quizId])
}

enum StageType {
  QUIZ
  INVESTIGATION
  PUZZLE
}

// â•â•â• Ğ£Ğ§ĞĞ¡Ğ¢ĞĞ˜ĞšĞ˜ Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ â•â•â•
model TournamentParticipant {
  id            Int       @id @default(autoincrement())
  tournamentId  Int
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  userId        Int
  user          User      @relation(fields: [userId], references: [id])
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ°
  status        ParticipantStatus @default(REGISTERED)
  
  // ĞĞ±Ñ‰Ğ¸Ğ¹ ÑÑ‡Ñ‘Ñ‚ Ğ² Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğµ
  totalScore    Int       @default(0)
  rank          Int?                           // Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ¼ĞµÑÑ‚Ğ¾
  
  // ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ
  currentStage  Int       @default(1)          // ĞĞ° ĞºĞ°ĞºĞ¾Ğ¼ ÑÑ‚Ğ°Ğ¿Ğµ ÑĞµĞ¹Ñ‡Ğ°Ñ
  
  joinedAt      DateTime  @default(now())
  
  @@unique([tournamentId, userId])
  @@index([tournamentId, totalScore(sort: Desc)])
  @@index([userId])
}

enum ParticipantStatus {
  REGISTERED    // Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
  ACTIVE        // ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ ÑƒÑ‡Ğ°ÑÑ‚Ğ²ÑƒĞµÑ‚
  ELIMINATED    // Ğ’Ñ‹Ğ±Ñ‹Ğ»
  FINISHED      // Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ» Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€
  WINNER        // ĞŸĞ¾Ğ±ĞµĞ´Ğ¸Ñ‚ĞµĞ»ÑŒ
}

// â•â•â• Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢Ğ« Ğ­Ğ¢ĞĞŸĞĞ’ â•â•â•
model TournamentStageResult {
  id            Int       @id @default(autoincrement())
  stageId       Int
  stage         TournamentStage @relation(fields: [stageId], references: [id], onDelete: Cascade)
  userId        Int
  user          User      @relation(fields: [userId], references: [id])
  
  score         Int                            // ĞÑ‡ĞºĞ¸ Ğ·Ğ° ÑÑ‚Ğ°Ğ¿
  rank          Int?                           // ĞœĞµÑÑ‚Ğ¾ Ğ² ÑÑ‚Ğ°Ğ¿Ğµ
  passed        Boolean   @default(false)      // ĞŸÑ€Ğ¾ÑˆÑ‘Ğ» Ğ»Ğ¸ Ğ´Ğ°Ğ»ÑŒÑˆĞµ
  
  // Ğ¡Ğ²ÑĞ·ÑŒ Ñ ÑĞµÑÑĞ¸ĞµĞ¹ ĞºĞ²Ğ¸Ğ·Ğ° (Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)
  quizSessionId Int?
  
  startedAt     DateTime  @default(now())
  completedAt   DateTime?
  
  @@unique([stageId, userId])
  @@index([stageId, score(sort: Desc)])
  @@index([userId])
}

// â•â•â• ĞŸĞ Ğ˜Ğ—Ğ« Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ â•â•â•
model TournamentPrize {
  id            Int       @id @default(autoincrement())
  tournamentId  Int
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  place         Int                            // 1, 2, 3...
  title         String                         // "1000â‚½" Ğ¸Ğ»Ğ¸ "Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ĞµĞ¹Ğ´Ğ¶"
  description   String?
  type          PrizeType  @default(XP)
  value         Int                            // Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ (Ñ€ÑƒĞ±Ğ»Ğ¸, XP, Ğ¸ Ñ‚.Ğ´.)
  icon          String     @default("ğŸ†")
  
  // ĞšÑ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»
  winnerId      Int?
  winner        User?     @relation(fields: [winnerId], references: [id])
  awardedAt     DateTime?
  
  @@unique([tournamentId, place])
  @@index([tournamentId])
  @@index([winnerId])
}

enum PrizeType {
  CASH          // Ğ”ĞµĞ½ĞµĞ¶Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ·
  XP            // ĞĞ¿Ñ‹Ñ‚
  BADGE         // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ĞµĞ¹Ğ´Ğ¶
  ENERGY        // Ğ‘Ğ¾Ğ½ÑƒÑĞ½Ğ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACHIEVEMENTS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model UserAchievement {
  id            Int      @id @default(autoincrement())
  
  userId        Int
  achievementId String   // ID Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ· lib/achievements.ts (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ "first_quiz")
  
  unlockedAt    DateTime @default(now())  // ĞšĞ¾Ğ³Ğ´Ğ° Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾
  progress      Int      @default(0)      // ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ»Ñ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ñ… Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
  notified      Boolean  @default(false)  // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ»Ğ¸ Ğ»Ğ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  
  user          User     @relation(fields: [userId], references: [id])
  
  @@unique([userId, achievementId]) // ĞĞ´Ğ½Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  @@index([userId])
  @@index([achievementId])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COSMETICS SHOP SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model CosmeticItem {
  id          Int           @id @default(autoincrement())
  slug        String        @unique           // "frame-gold", "frame-fire"
  type        CosmeticType  @default(FRAME)
  title       String                          // "Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ°Ñ Ñ€Ğ°Ğ¼ĞºĞ°"
  description String?
  imageUrl    String                          // "/frames/gold.png"
  previewUrl  String?                         // ĞŸÑ€ĞµĞ²ÑŒÑ Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğµ
  
  priceStars  Int                             // Ğ¦ĞµĞ½Ğ° Ğ² Telegram Stars
  rarity      Rarity        @default(COMMON)  // COMMON, RARE, EPIC, LEGENDARY
  
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  
  // ĞšÑ‚Ğ¾ Ğ½Ğ°Ğ´ĞµĞ» ÑÑ‚Ñƒ Ñ€Ğ°Ğ¼ĞºÑƒ
  equippedBy  User[]        @relation("EquippedFrame")
  
  owners      UserInventory[]
  purchases   Purchase[]
  
  @@index([type])
  @@index([rarity])
  @@index([isActive])
}

model UserInventory {
  id          Int           @id @default(autoincrement())
  userId      Int
  itemId      Int
  acquiredAt  DateTime      @default(now())
  
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  item        CosmeticItem  @relation(fields: [itemId], references: [id])
  
  @@unique([userId, itemId])
  @@index([userId])
}

model Purchase {
  id                Int             @id @default(autoincrement())
  
  userId            Int
  itemId            Int
  
  telegramPaymentId String          @unique       // ID Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ° Ğ¾Ñ‚ Telegram
  amountStars       Int                           // Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Stars ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¾
  status            PurchaseStatus  @default(PENDING)
  
  createdAt         DateTime        @default(now())
  completedAt       DateTime?
  
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  item              CosmeticItem    @relation(fields: [itemId], references: [id])
  
  @@index([userId])
  @@index([telegramPaymentId])
  @@index([status])
}

enum CosmeticType {
  FRAME
  BADGE       // ĞĞ° Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ
  BACKGROUND  // ĞĞ° Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ
}

enum Rarity {
  COMMON
  RARE
  EPIC
  LEGENDARY
}

enum PurchaseStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}
