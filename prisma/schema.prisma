generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Profile Status enum
enum UserStatus {
  ONLINE        // Ğ’ ÑĞµÑ‚Ğ¸
  PLAYING       // Ğ˜Ğ³Ñ€Ğ°ĞµÑ‚ (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸)
  LOOKING_DUEL  // Ğ˜Ñ‰Ñƒ Ğ´ÑƒÑĞ»ÑŒ
  BUSY          // Ğ—Ğ°Ğ½ÑÑ‚
  OFFLINE       // ĞĞµ Ğ² ÑĞµÑ‚Ğ¸
}

model User {
  id         Int           @id @default(autoincrement())
  telegramId String        @unique
  username   String?
  firstName  String?
  lastName   String?
  photoUrl   String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PROFILE 2.0 - Enhanced Social Profile
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  bio                 String?         @db.VarChar(100)  // ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (Ğ´Ğ¾ 100 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
  status              UserStatus      @default(ONLINE)  // Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ
  statusEmoji         String?         @db.VarChar(10)   // ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ emoji Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
  statusText          String?         @db.VarChar(50)   // ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
  lastSeenAt          DateTime        @default(now())   // ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
  
  // Showcase Achievements (3 Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ)
  showcaseAchievement1  String?       // ID Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ #1
  showcaseAchievement2  String?       // ID Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ #2
  showcaseAchievement3  String?       // ID Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ #3
  
  // Privacy Settings
  profilePublic       Boolean         @default(true)    // ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ²Ğ¸Ğ´ĞµĞ½ Ğ²ÑĞµĞ¼
  showActivity        Boolean         @default(true)    // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ñ€ÑƒĞ·ÑŒÑĞ¼
  showOnlineStatus    Boolean         @default(true)    // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½
  
  // Currently playing (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ)
  currentQuizId       Int?            // ĞšĞ°ĞºĞ¾Ğ¹ ĞºĞ²Ğ¸Ğ· ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚
  currentQuiz         Quiz?           @relation("CurrentlyPlaying", fields: [currentQuizId], references: [id])
  currentSessionStart DateTime?       // ĞšĞ¾Ğ³Ğ´Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ» Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ÑĞµÑÑĞ¸Ñ
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // XP System
  xp              Int       @default(0)      // Total experience points
  lastQuizAt      DateTime?                  // Last quiz completion (for daily bonus tracking)
  
  // Daily Rewards System
  dailyRewardStreak   Int       @default(0)      // Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ´Ğ½ĞµĞ¹ (1-7, Ğ´Ğ»Ñ UI Ñ†Ğ¸ĞºĞ»Ğ° Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´)
  totalDailyStreak    Int       @default(0)      // ĞĞ±Ñ‰Ğ°Ñ Ğ½ĞµĞ¿Ñ€ĞµÑ€Ñ‹Ğ²Ğ½Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ´Ğ½ĞµĞ¹ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹, Ğ½Ğµ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° 7)
  maxDailyStreak      Int       @default(0)      // ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ·Ğ° Ğ²ÑÑ‘ Ğ²Ñ€ĞµĞ¼Ñ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹)
  lastDailyRewardAt   DateTime?                  // ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ· Ğ·Ğ°Ğ±Ñ€Ğ°Ğ» Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñƒ
  
  // Bonus Energy System (from Daily Rewards)
  bonusEnergy         Int       @default(0)      // Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ±Ğ¾Ğ½ÑƒÑĞ½Ğ¾Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸
  bonusEnergyEarned   Int       @default(0)      // Ğ’ÑĞµĞ³Ğ¾ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹)
  bonusEnergyUsed     Int       @default(0)      // Ğ’ÑĞµĞ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹)
  
  // Notification Preferences
  notifyLevelUp       Boolean   @default(true)   // Level up notifications
  notifyEnergyFull    Boolean   @default(true)   // Energy restored notifications
  notifyDailyReminder Boolean   @default(true)   // Daily play reminder
  notifyLeaderboard   Boolean   @default(false)  // Leaderboard changes
  notifyFriends       Boolean   @default(true)   // Friend activity
  lastNotifiedAt      DateTime?                  // Last notification sent (rate limiting)
  
  sessions   QuizSession[]
  leaderboardEntries LeaderboardEntry[]
  
  // Weekly competition
  weeklyScores  WeeklyScore[]
  weeklyWins    WeeklyWinner[]
  
  // Friends relationships
  friendsAdded    Friendship[] @relation("FriendshipUser")
  friendsReceived Friendship[] @relation("FriendshipFriend")
  
  // Chat messages
  chatMessages      ChatMessage[]
  messageReactions  MessageReaction[]
  
  // Achievements
  achievements    UserAchievement[]
  
  // Referral System
  referralCode    String?   @unique  // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ (Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ)
  referredById    Int?               // ĞšÑ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ğ» ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  referredBy      User?     @relation("ReferralRelation", fields: [referredById], references: [id])
  referrals       User[]    @relation("ReferralRelation")  // ĞšĞ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ğ» ÑÑ‚Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
  
  @@index([referredById])           // Ğ”Ğ»Ñ referral queries
  @@index([xp(sort: Desc)])         // Ğ”Ğ»Ñ global leaderboard queries
  
  // Tournaments
  tournamentParticipations TournamentParticipant[]
  tournamentStageResults   TournamentStageResult[]
  tournamentPrizes         TournamentPrize[]
  
  // Cosmetics Shop
  equippedFrameId Int?
  equippedFrame   CosmeticItem? @relation("EquippedFrame", fields: [equippedFrameId], references: [id])
  inventory       UserInventory[]
  purchases       Purchase[]
  
  // Scheduled Notifications
  scheduledNotifications ScheduledNotification[]
  
  // Investigations (Crime Map)
  investigationProgress  InvestigationProgress[]
  
  // Activity Feed
  activities             UserActivity[]
  
  // Duels (1v1 battles)
  duelsAsChallenger      Duel[] @relation("DuelChallenger")
  duelsAsOpponent        Duel[] @relation("DuelOpponent")
}

model Friendship {
  id        Int              @id @default(autoincrement())
  userId    Int              // ĞšÑ‚Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ» Ğ·Ğ°ÑĞ²ĞºÑƒ
  friendId  Int              // ĞšĞ¾Ğ¼Ñƒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»
  status    FriendshipStatus @default(PENDING)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @default(now()) @updatedAt
  
  user   User @relation("FriendshipUser", fields: [userId], references: [id])
  friend User @relation("FriendshipFriend", fields: [friendId], references: [id])
  
  @@unique([userId, friendId])
  @@index([userId])
  @@index([friendId])
  @@index([status])
}

enum FriendshipStatus {
  PENDING   // ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
  ACCEPTED  // ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ°
  DECLINED  // ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ°
}

model Quiz {
  id               Int            @id @default(autoincrement())
  title            String
  description      String?
  isActive         Boolean        @default(true)
  startsAt         DateTime?
  endsAt           DateTime?
  prizeTitle       String
  prizeDescription String?
  questions        Question[]
  sessions         QuizSession[]
  leaderboardEntries LeaderboardEntry[]
  
  // Tournament stages that use this quiz
  tournamentStages TournamentStage[]
  
  // Duels using this quiz
  duels            Duel[]
  
  // Users currently playing this quiz (Profile 2.0)
  usersCurrentlyPlaying User[] @relation("CurrentlyPlaying")
}

model Question {
  id               Int             @id @default(autoincrement())
  quizId           Int
  text             String
  order            Int
  timeLimitSeconds Int?
  difficulty       Int             @default(1) // 1 = Ğ»ĞµĞ³ĞºĞ¸Ğ¹, 2 = ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹, 3 = ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹
  quiz             Quiz            @relation(fields: [quizId], references: [id])
  answers          AnswerOption[]
  responses        Answer[]        @relation("QuestionResponses")
  
  @@index([quizId])                 // Ğ”Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² ĞºĞ²Ğ¸Ğ·Ğ°
  @@index([quizId, order])          // Ğ”Ğ»Ñ ÑƒĞ¿Ğ¾Ñ€ÑĞ´Ğ¾Ñ‡ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
}

model AnswerOption {
  id         Int       @id @default(autoincrement())
  questionId Int
  text       String
  isCorrect  Boolean   @default(false)
  question   Question  @relation(fields: [questionId], references: [id])
  answers    Answer[]
  
  @@index([questionId])             // Ğ”Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
}

model QuizSession {
  id                       Int       @id @default(autoincrement())
  userId                   Int
  quizId                   Int
  startedAt                DateTime  @default(now())
  finishedAt               DateTime?
  totalScore               Int       @default(0)
  attemptNumber            Int       @default(1) // ĞĞ¾Ğ¼ĞµÑ€ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ĞºĞ²Ğ¸Ğ·Ğ°
  currentQuestionIndex     Int       @default(0) // Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° (0-based)
  currentQuestionStartedAt DateTime? // ĞšĞ¾Ğ³Ğ´Ğ° Ğ±Ñ‹Ğ» Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ (server-side)
  currentStreak            Int       @default(0) // Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (server-side)
  maxStreak                Int       @default(0) // ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞµÑ€Ğ¸Ñ Ğ·Ğ° ÑĞµÑÑĞ¸Ñ (Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹)
  user                     User      @relation(fields: [userId], references: [id])
  quiz                     Quiz      @relation(fields: [quizId], references: [id])
  answers                  Answer[]
  
  @@index([userId, quizId])
  @@index([startedAt])              // Ğ”Ğ»Ñ energy calculations
  @@index([userId, startedAt])      // Ğ”Ğ»Ñ global energy queries
  @@index([userId, finishedAt])     // Ğ”Ğ»Ñ rate limit queries
}

model Answer {
  id          Int           @id @default(autoincrement())
  sessionId   Int
  questionId  Int
  optionId    Int?          // Nullable for timeout (no answer selected)
  isCorrect   Boolean
  timeSpentMs Int
  scoreDelta  Int
  isTimeout   Boolean       @default(false) // Flag for timeout answers
  createdAt   DateTime      @default(now())
  session     QuizSession   @relation(fields: [sessionId], references: [id])
  question    Question      @relation("QuestionResponses", fields: [questionId], references: [id])
  option      AnswerOption? @relation(fields: [optionId], references: [id])
  
  @@unique([sessionId, questionId]) // Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ½Ğ° Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ
  @@index([sessionId])
}

model LeaderboardEntry {
  id         Int      @id @default(autoincrement())
  userId     Int
  quizId     Int
  periodType String
  bestScore  Int      @default(0)  // Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ·Ğ° Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ³Ñ€Ñƒ
  attempts   Int      @default(1)  // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])
  quiz       Quiz     @relation(fields: [quizId], references: [id])

  @@unique([userId, quizId, periodType])
  @@index([quizId, periodType, bestScore])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEEKLY COMPETITION SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Weekly scores - resets every Sunday at 23:59
model WeeklyScore {
  id        Int      @id @default(autoincrement())
  userId    Int
  weekStart DateTime // Monday 00:00 of the week
  bestScore Int      @default(0)  // Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ·Ğ° Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ³Ñ€Ñƒ Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ğµ
  quizzes   Int      @default(0)  // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ğ³Ñ€ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, weekStart])
  @@index([weekStart, bestScore])
}

// Archive of weekly winners
model WeeklyWinner {
  id        Int      @id @default(autoincrement())
  userId    Int
  weekStart DateTime // Monday 00:00 of the week
  weekEnd   DateTime // Sunday 23:59 of the week
  place     Int      // 1, 2, or 3
  score     Int
  prize     String?  // Prize description
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@unique([weekStart, place])
  @@index([userId])
  @@index([weekStart])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBAL CHAT SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model ChatMessage {
  id        Int      @id @default(autoincrement())
  userId    Int
  text      String   @db.VarChar(500) // ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 500 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id])
  reactions MessageReaction[]
  
  @@index([createdAt(sort: Desc)]) // Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
  @@index([userId])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MESSAGE REACTIONS
// Ğ ĞµĞ°ĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ² Ñ‡Ğ°Ñ‚Ğµ (â¤ï¸ ğŸ”¥ ğŸ˜‚ ğŸ‘ ğŸ˜® ğŸ˜¢)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model MessageReaction {
  id        Int      @id @default(autoincrement())
  messageId Int
  userId    Int
  emoji     String   @db.VarChar(10) // Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¸
  createdAt DateTime @default(now())
  
  message   ChatMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([messageId, userId]) // ĞĞ´Ğ¸Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ â€” Ğ¾Ğ´Ğ½Ğ° Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ğ½Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
  @@index([messageId])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USER ACTIVITY FEED SYSTEM
// Ğ›ĞµĞ½Ñ‚Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ·ĞµĞ¹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model UserActivity {
  id        Int              @id @default(autoincrement())
  userId    Int
  type      ActivityType
  
  // Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ°)
  data      Json             // { quizId, quizTitle, score, rank, achievementId, etc. }
  
  // Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
  title     String           // "ĞŸÑ€Ğ¾ÑˆÑ‘Ğ» ĞºĞ²Ğ¸Ğ· Â«Ğ—Ğ½Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ñ‹Ğµ Ğ´ĞµĞ»Ğ°Â»"
  icon      String           @default("ğŸ¯") // Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
  
  // Ğ’Ñ€ĞµĞ¼Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ
  createdAt DateTime         @default(now())
  
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, createdAt(sort: Desc)])  // Ğ”Ğ»Ñ Ğ»ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  @@index([createdAt(sort: Desc)])          // Ğ”Ğ»Ñ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ»ĞµĞ½Ñ‚Ñ‹ Ğ´Ñ€ÑƒĞ·ĞµĞ¹
}

enum ActivityType {
  QUIZ_COMPLETED        // ĞŸÑ€Ğ¾ÑˆÑ‘Ğ» ĞºĞ²Ğ¸Ğ·
  QUIZ_HIGH_SCORE       // ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´ Ğ² ĞºĞ²Ğ¸Ğ·Ğµ
  ACHIEVEMENT_UNLOCKED  // ĞÑ‚ĞºÑ€Ñ‹Ğ» Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ
  LEVEL_UP              // ĞŸĞ¾Ğ²Ñ‹ÑĞ¸Ğ» ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
  TOURNAMENT_JOIN       // ĞŸÑ€Ğ¸ÑĞ¾ĞµĞ´Ğ¸Ğ½Ğ¸Ğ»ÑÑ Ğº Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ñƒ
  TOURNAMENT_STAGE      // ĞŸÑ€Ğ¾ÑˆÑ‘Ğ» ÑÑ‚Ğ°Ğ¿ Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğ°
  TOURNAMENT_WIN        // Ğ—Ğ°Ğ½ÑĞ» Ğ¼ĞµÑÑ‚Ğ¾ Ğ² Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğµ
  FRIEND_ADDED          // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» Ğ´Ñ€ÑƒĞ³Ğ°
  STREAK_MILESTONE      // Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³ ÑĞµÑ€Ğ¸Ğ¸ Ğ´Ğ½ĞµĞ¹ (7, 14, 30)
  DUEL_WON              // ĞŸĞ¾Ğ±ĞµĞ´Ğ¸Ğ» Ğ² Ğ´ÑƒÑĞ»Ğ¸
  DUEL_LOST             // ĞŸÑ€Ğ¾Ğ¸Ğ³Ñ€Ğ°Ğ» Ğ´ÑƒÑĞ»ÑŒ
  DUEL_DRAW             // ĞĞ¸Ñ‡ÑŒÑ Ğ² Ğ´ÑƒÑĞ»Ğ¸
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOURNAMENTS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Tournament {
  id            Int       @id @default(autoincrement())
  slug          String    @unique              // URL-friendly ID: "serial-killers-60s"
  title         String                         // "Ğ¡ĞµÑ€Ğ¸Ğ¹Ğ½Ğ¸ĞºĞ¸ 60-Ñ…"
  description   String?
  icon          String    @default("âš”ï¸")       // Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸ĞºĞ¾Ğ½ĞºĞ°
  coverImage    String?                        // URL Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸
  gradientFrom  String    @default("#2d132c")  // Ğ¦Ğ²ĞµÑ‚ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ° (Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾)
  gradientTo    String    @default("#1a1a2e")  // Ğ¦Ğ²ĞµÑ‚ Ğ³Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚Ğ° (ĞºĞ¾Ğ½ĞµÑ†)
  
  // Ğ’Ñ€ĞµĞ¼Ñ
  startsAt      DateTime
  endsAt        DateTime
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  status        TournamentStatus @default(UPCOMING)
  
  // ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
  minPlayers    Int       @default(3)          // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ğ´Ğ»Ñ Ñ€Ğ¾Ğ·Ñ‹Ğ³Ñ€Ñ‹ÑˆĞ°
  maxPlayers    Int?                           // null = Ğ±ĞµĞ·Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
  entryFee      Int       @default(0)          // Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² XP (0 = Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)
  
  // Ğ¢Ğ¸Ğ¿ Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğ°
  type          TournamentType @default(QUIZ)
  
  // Ğ¡Ğ²ÑĞ·Ğ¸
  stages        TournamentStage[]
  participants  TournamentParticipant[]
  prizes        TournamentPrize[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([status])
  @@index([startsAt])
  @@index([endsAt])
}

enum TournamentStatus {
  DRAFT       // Ğ§ĞµÑ€Ğ½Ğ¾Ğ²Ğ¸Ğº (Ğ½Ğµ Ğ²Ğ¸Ğ´ĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼)
  UPCOMING    // Ğ¡ĞºĞ¾Ñ€Ğ¾ Ğ½Ğ°Ñ‡Ğ½Ñ‘Ñ‚ÑÑ
  ACTIVE      // Ğ˜Ğ´Ñ‘Ñ‚ ÑĞµĞ¹Ñ‡Ğ°Ñ
  FINISHED    // Ğ—Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½
  CANCELLED   // ĞÑ‚Ğ¼ĞµĞ½Ñ‘Ğ½
}

enum TournamentType {
  QUIZ           // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ²Ğ¸Ğ·Ñ‹
  INVESTIGATION  // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)
  MIXED          // Ğ¡Ğ¼ĞµÑˆĞ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)
}

// â•â•â• Ğ­Ğ¢ĞĞŸĞ« Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ â•â•â•
model TournamentStage {
  id            Int       @id @default(autoincrement())
  tournamentId  Int
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  order         Int                            // ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº ÑÑ‚Ğ°Ğ¿Ğ° (1, 2, 3...)
  title         String                         // "ĞšĞ²Ğ°Ğ»Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ", "Ğ¤Ğ¸Ğ½Ğ°Ğ»"
  description   String?
  type          StageType  @default(QUIZ)
  
  // Ğ’Ñ€ĞµĞ¼Ñ ÑÑ‚Ğ°Ğ¿Ğ° (ĞµÑĞ»Ğ¸ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğ°)
  startsAt      DateTime?
  endsAt        DateTime?
  
  // ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
  quizId        Int?                           // Ğ¡Ğ²ÑĞ·ÑŒ Ñ ĞºĞ²Ğ¸Ğ·Ğ¾Ğ¼
  quiz          Quiz?      @relation(fields: [quizId], references: [id])
  
  // ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
  topN          Int?                           // Ğ¢Ğ¾Ğ¿-N Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚ Ğ´Ğ°Ğ»ÑŒÑˆĞµ (null = Ğ²ÑĞµ)
  minScore      Int?                           // ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ» Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ°
  
  // ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‡ĞºĞ¾Ğ² Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑÑ‚Ğ°Ğ¿Ğ°
  scoreMultiplier Float    @default(1.0)       // 1.0 = Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ğ¾Ñ‡ĞºĞ¸, 2.0 = Ğ´Ğ²Ğ¾Ğ¹Ğ½Ñ‹Ğµ
  
  // Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
  results       TournamentStageResult[]
  
  @@unique([tournamentId, order])
  @@index([tournamentId])
  @@index([quizId])
}

enum StageType {
  QUIZ
  INVESTIGATION
  PUZZLE
}

// â•â•â• Ğ£Ğ§ĞĞ¡Ğ¢ĞĞ˜ĞšĞ˜ Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ â•â•â•
model TournamentParticipant {
  id            Int       @id @default(autoincrement())
  tournamentId  Int
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  userId        Int
  user          User      @relation(fields: [userId], references: [id])
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ°
  status        ParticipantStatus @default(REGISTERED)
  
  // ĞĞ±Ñ‰Ğ¸Ğ¹ ÑÑ‡Ñ‘Ñ‚ Ğ² Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğµ
  totalScore    Int       @default(0)
  rank          Int?                           // Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ¼ĞµÑÑ‚Ğ¾
  
  // ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ
  currentStage  Int       @default(1)          // ĞĞ° ĞºĞ°ĞºĞ¾Ğ¼ ÑÑ‚Ğ°Ğ¿Ğµ ÑĞµĞ¹Ñ‡Ğ°Ñ
  
  joinedAt      DateTime  @default(now())
  
  @@unique([tournamentId, userId])
  @@index([tournamentId, totalScore(sort: Desc)])
  @@index([userId])
}

enum ParticipantStatus {
  REGISTERED    // Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
  ACTIVE        // ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ ÑƒÑ‡Ğ°ÑÑ‚Ğ²ÑƒĞµÑ‚
  ELIMINATED    // Ğ’Ñ‹Ğ±Ñ‹Ğ»
  FINISHED      // Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ» Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€
  WINNER        // ĞŸĞ¾Ğ±ĞµĞ´Ğ¸Ñ‚ĞµĞ»ÑŒ
}

// â•â•â• Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢Ğ« Ğ­Ğ¢ĞĞŸĞĞ’ â•â•â•
model TournamentStageResult {
  id            Int       @id @default(autoincrement())
  stageId       Int
  stage         TournamentStage @relation(fields: [stageId], references: [id], onDelete: Cascade)
  userId        Int
  user          User      @relation(fields: [userId], references: [id])
  
  score         Int                            // ĞÑ‡ĞºĞ¸ Ğ·Ğ° ÑÑ‚Ğ°Ğ¿
  rank          Int?                           // ĞœĞµÑÑ‚Ğ¾ Ğ² ÑÑ‚Ğ°Ğ¿Ğµ
  passed        Boolean   @default(false)      // ĞŸÑ€Ğ¾ÑˆÑ‘Ğ» Ğ»Ğ¸ Ğ´Ğ°Ğ»ÑŒÑˆĞµ
  
  // Ğ¡Ğ²ÑĞ·ÑŒ Ñ ÑĞµÑÑĞ¸ĞµĞ¹ ĞºĞ²Ğ¸Ğ·Ğ° (Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)
  quizSessionId Int?
  
  startedAt     DateTime  @default(now())
  completedAt   DateTime?
  
  @@unique([stageId, userId])
  @@index([stageId, score(sort: Desc)])
  @@index([userId])
}

// â•â•â• ĞŸĞ Ğ˜Ğ—Ğ« Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ â•â•â•
model TournamentPrize {
  id            Int       @id @default(autoincrement())
  tournamentId  Int
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  place         Int                            // 1, 2, 3...
  title         String                         // "1000â‚½" Ğ¸Ğ»Ğ¸ "Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ĞµĞ¹Ğ´Ğ¶"
  description   String?
  type          PrizeType  @default(XP)
  value         Int                            // Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ (Ñ€ÑƒĞ±Ğ»Ğ¸, XP, Ğ¸ Ñ‚.Ğ´.)
  icon          String     @default("ğŸ†")
  
  // ĞšÑ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»
  winnerId      Int?
  winner        User?     @relation(fields: [winnerId], references: [id])
  awardedAt     DateTime?
  
  @@unique([tournamentId, place])
  @@index([tournamentId])
  @@index([winnerId])
}

enum PrizeType {
  CASH          // Ğ”ĞµĞ½ĞµĞ¶Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ·
  XP            // ĞĞ¿Ñ‹Ñ‚
  BADGE         // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ĞµĞ¹Ğ´Ğ¶
  ENERGY        // Ğ‘Ğ¾Ğ½ÑƒÑĞ½Ğ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACHIEVEMENTS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model UserAchievement {
  id            Int      @id @default(autoincrement())
  
  userId        Int
  achievementId String   // ID Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ· lib/achievements.ts (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ "first_quiz")
  
  unlockedAt    DateTime @default(now())  // ĞšĞ¾Ğ³Ğ´Ğ° Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾
  progress      Int      @default(0)      // ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ»Ñ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ñ… Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
  notified      Boolean  @default(false)  // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ»Ğ¸ Ğ»Ğ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  
  user          User     @relation(fields: [userId], references: [id])
  
  @@unique([userId, achievementId]) // ĞĞ´Ğ½Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  @@index([userId])
  @@index([achievementId])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COSMETICS SHOP SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model CosmeticItem {
  id          Int           @id @default(autoincrement())
  slug        String        @unique           // "frame-gold", "frame-fire"
  type        CosmeticType  @default(FRAME)
  title       String                          // "Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ°Ñ Ñ€Ğ°Ğ¼ĞºĞ°"
  description String?
  imageUrl    String                          // "/frames/gold.png"
  previewUrl  String?                         // ĞŸÑ€ĞµĞ²ÑŒÑ Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğµ
  
  priceStars  Int                             // Ğ¦ĞµĞ½Ğ° Ğ² Telegram Stars
  rarity      Rarity        @default(COMMON)  // COMMON, RARE, EPIC, LEGENDARY
  
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  
  // ĞšÑ‚Ğ¾ Ğ½Ğ°Ğ´ĞµĞ» ÑÑ‚Ñƒ Ñ€Ğ°Ğ¼ĞºÑƒ
  equippedBy  User[]        @relation("EquippedFrame")
  
  owners      UserInventory[]
  purchases   Purchase[]
  
  @@index([type])
  @@index([rarity])
  @@index([isActive])
}

model UserInventory {
  id          Int           @id @default(autoincrement())
  userId      Int
  itemId      Int
  acquiredAt  DateTime      @default(now())
  
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  item        CosmeticItem  @relation(fields: [itemId], references: [id])
  
  @@unique([userId, itemId])
  @@index([userId])
}

model Purchase {
  id                Int             @id @default(autoincrement())
  
  userId            Int
  itemId            Int
  
  telegramPaymentId String          @unique       // ID Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ° Ğ¾Ñ‚ Telegram
  amountStars       Int                           // Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Stars ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¾
  status            PurchaseStatus  @default(PENDING)
  
  createdAt         DateTime        @default(now())
  completedAt       DateTime?
  
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  item              CosmeticItem    @relation(fields: [itemId], references: [id])
  
  @@index([userId])
  @@index([telegramPaymentId])
  @@index([status])
}

enum CosmeticType {
  FRAME
  BADGE       // ĞĞ° Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ
  BACKGROUND  // ĞĞ° Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ
}

enum Rarity {
  COMMON
  RARE
  EPIC
  LEGENDARY
}

enum PurchaseStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCHEDULED NOTIFICATIONS
// Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ² Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model ScheduledNotification {
  id          Int                         @id @default(autoincrement())
  userId      Int
  type        ScheduledNotificationType
  scheduledAt DateTime                    // ĞšĞ¾Ğ³Ğ´Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ
  data        Json?                       // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°
  
  createdAt   DateTime                    @default(now())
  sentAt      DateTime?                   // null = Ğ½Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾
  
  user        User                        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([scheduledAt, sentAt])          // Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ½ĞµĞ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ…
  @@index([userId, type])                 // Ğ”Ğ»Ñ Ğ´ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
}

enum ScheduledNotificationType {
  ENERGY_RESTORED                         // Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°
  DAILY_REMINDER                          // Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ
  TOURNAMENT_STARTING                     // Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€ ÑĞºĞ¾Ñ€Ğ¾ Ğ½Ğ°Ñ‡Ğ½Ñ‘Ñ‚ÑÑ
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INVESTIGATIONS SYSTEM (Crime Map)
// Ğ Ğ°ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ â€” Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ´ĞµĞ»Ğ° Ñ ÑÑĞ¶ĞµÑ‚Ğ¾Ğ¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Investigation {
  id            Int       @id @default(autoincrement())
  slug          String    @unique              // URL-friendly: "chikatilo", "bitsa-maniac"
  
  // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
  title         String                         // "Ğ Ğ¾ÑÑ‚Ğ¾Ğ²ÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ñ‚Ñ€Ğ¾ÑˆĞ¸Ñ‚ĞµĞ»ÑŒ"
  subtitle      String?                        // "Ğ”ĞµĞ»Ğ¾ Ğ§Ğ¸ĞºĞ°Ñ‚Ğ¸Ğ»Ğ¾"
  description   String    @db.Text             // ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´ĞµĞ»Ğ°
  
  // Ğ›Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğµ
  city          String                         // "Ğ Ğ¾ÑÑ‚Ğ¾Ğ²-Ğ½Ğ°-Ğ”Ğ¾Ğ½Ñƒ"
  years         String                         // "1978-1990"
  coordinates   Json                           // { x: 65, y: 55 } â€” Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğµ
  
  // Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
  icon          String    @default("ğŸ”")       // Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸ĞºĞ¾Ğ½ĞºĞ°
  color         String    @default("#ef4444")  // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ²ĞµÑ‚
  coverImage    String?                        // URL Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸
  
  // Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹
  difficulty    InvestigationDifficulty @default(MEDIUM)
  xpReward      Int       @default(500)        // XP Ğ·Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ
  
  // Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ
  unlockType    UnlockType @default(FREE)      // ĞšĞ°Ğº Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ÑÑ
  unlockValue   Int?                           // Ğ¦ĞµĞ½Ğ° Ğ² Stars / ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ / Ğ¸ Ñ‚.Ğ´.
  order         Int       @default(0)          // ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  isActive      Boolean   @default(false)      // Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼
  isFeatured    Boolean   @default(false)      // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Ğ¡Ğ²ÑĞ·Ğ¸
  episodes      InvestigationEpisode[]
  progress      InvestigationProgress[]
  suspects      InvestigationSuspect[]
  
  @@index([isActive, order])
  @@index([difficulty])
}

enum InvestigationDifficulty {
  EASY          // Ğ”Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ¾Ğ²
  MEDIUM        // Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ°Ñ
  HARD          // Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ
  EXTREME       // Ğ­ĞºÑÑ‚Ñ€ĞµĞ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ
}

enum UnlockType {
  FREE          // Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ²ÑĞµÑ…
  LEVEL         // ĞÑƒĞ¶ĞµĞ½ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
  STARS         // ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ° Ğ·Ğ° Telegram Stars
  PREVIOUS      // ĞÑƒĞ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ Ñ€Ğ°ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
  ACHIEVEMENT   // ĞÑƒĞ¶Ğ½Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ
}

// â•â•â• Ğ­ĞŸĞ˜Ğ—ĞĞ”Ğ« Ğ ĞĞ¡Ğ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞĞ˜Ğ¯ â•â•â•
// ĞšĞ°Ğ¶Ğ´Ğ¾Ğµ Ñ€Ğ°ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· 5-7 ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğ¾Ğ²
model InvestigationEpisode {
  id                Int       @id @default(autoincrement())
  investigationId   Int
  investigation     Investigation @relation(fields: [investigationId], references: [id], onDelete: Cascade)
  
  order             Int                        // ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğ° (1, 2, 3...)
  title             String                     // "ĞÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¼ĞµÑÑ‚Ğ° Ğ¿Ñ€ĞµÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ñ"
  description       String?                    // ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
  
  // Ğ¢Ğ¸Ğ¿ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğ°
  type              EpisodeType @default(QUIZ)
  
  // ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ°
  content           Json                       // Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğ°
  // Ğ”Ğ»Ñ QUIZ: { quizId: 1 } Ğ¸Ğ»Ğ¸ { questions: [...] }
  // Ğ”Ğ»Ñ STORY: { scenes: [...], choices: [...] }
  // Ğ”Ğ»Ñ EVIDENCE: { items: [...], connections: [...] }
  // Ğ”Ğ»Ñ INTERROGATION: { suspect: "...", dialogue: [...] }
  
  // Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
  minScore          Int?                       // ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ» Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ° (Ğ´Ğ»Ñ QUIZ)
  timeLimit         Int?                       // Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…
  
  // ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ·Ğ° ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´
  xpReward          Int       @default(50)     // XP Ğ·Ğ° Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ
  
  // Ğ§Ñ‚Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğ°
  unlocksClue       String?                    // ID ÑƒĞ»Ğ¸ĞºĞ¸ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ
  
  createdAt         DateTime  @default(now())
  
  // Ğ¡Ğ²ÑĞ·Ğ¸
  userProgress      EpisodeProgress[]
  
  @@unique([investigationId, order])
  @@index([investigationId])
}

enum EpisodeType {
  STORY           // Ğ¡ÑĞ¶ĞµÑ‚Ğ½Ğ°Ñ Ğ²ÑÑ‚Ğ°Ğ²ĞºĞ° Ñ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°Ğ¼Ğ¸
  QUIZ            // ĞšĞ²Ğ¸Ğ·-Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ Ñ‚ĞµĞ¼Ğµ
  EVIDENCE        // ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑƒĞ»Ğ¸Ğº (connect-the-dots)
  INTERROGATION   // Ğ”Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€ĞµĞ²Ğ°ĞµĞ¼Ğ¾Ğ³Ğ¾
  DEDUCTION       // Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´ĞµĞ´ÑƒĞºÑ†Ğ¸Ñ â€” Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ñ€ĞµÑÑ‚ÑƒĞ¿Ğ½Ğ¸ĞºĞ°
}

// â•â•â• ĞŸĞĞ”ĞĞ—Ğ Ğ•Ğ’ĞĞ•ĞœĞ«Ğ• Ğ’ Ğ ĞĞ¡Ğ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞĞ˜Ğ˜ â•â•â•
// Ğ”Ğ»Ñ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ´ĞµĞ´ÑƒĞºÑ†Ğ¸Ğ¸
model InvestigationSuspect {
  id                Int       @id @default(autoincrement())
  investigationId   Int
  investigation     Investigation @relation(fields: [investigationId], references: [id], onDelete: Cascade)
  
  name              String                     // "Ğ˜Ğ²Ğ°Ğ½ ĞŸĞµÑ‚Ñ€Ğ¾Ğ²"
  description       String                     // ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€ĞµĞ²Ğ°ĞµĞ¼Ğ¾Ğ³Ğ¾
  photoUrl          String?                    // Ğ¤Ğ¾Ñ‚Ğ¾
  
  isGuilty          Boolean   @default(false)  // Ğ­Ñ‚Ğ¾ Ğ¿Ñ€ĞµÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğº?
  
  // Ğ£Ğ»Ğ¸ĞºĞ¸ Ğ·Ğ° Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²
  evidenceFor       Json?                      // ["ÑƒĞ»Ğ¸ĞºĞ°1", "ÑƒĞ»Ğ¸ĞºĞ°2"]
  evidenceAgainst   Json?                      // ["Ğ°Ğ»Ğ¸Ğ±Ğ¸", "Ğ¼Ğ¾Ñ‚Ğ¸Ğ² Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚"]
  
  order             Int       @default(0)
  
  @@index([investigationId])
}

// â•â•â• ĞŸĞ ĞĞ“Ğ Ğ•Ğ¡Ğ¡ ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¯ ĞŸĞ Ğ ĞĞ¡Ğ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞĞ˜Ğ® â•â•â•
model InvestigationProgress {
  id                Int       @id @default(autoincrement())
  userId            Int
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  investigationId   Int
  investigation     Investigation @relation(fields: [investigationId], references: [id], onDelete: Cascade)
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  status            InvestigationStatus @default(NOT_STARTED)
  
  // ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ
  currentEpisode    Int       @default(1)      // ĞĞ° ĞºĞ°ĞºĞ¾Ğ¼ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğµ
  totalScore        Int       @default(0)      // ĞĞ±Ñ‰Ğ¸Ğµ Ğ¾Ñ‡ĞºĞ¸ Ğ·Ğ° Ñ€Ğ°ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
  
  // Ğ¡Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ»Ğ¸ĞºĞ¸ (ID ÑƒĞ»Ğ¸Ğº)
  collectedClues    Json      @default("[]")   // ["clue1", "clue2", ...]
  
  // Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€ĞµĞ²Ğ°ĞµĞ¼Ğ¾Ğ³Ğ¾
  suspectChoiceId   Int?                       // ĞšĞ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ²Ğ¸Ğ½Ğ¸Ğ»
  isCorrectChoice   Boolean?                   // ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ»Ğ¸ ÑƒĞ³Ğ°Ğ´Ğ°Ğ»
  
  // Ğ’Ñ€ĞµĞ¼Ñ
  startedAt         DateTime  @default(now())
  completedAt       DateTime?
  
  // Ğ¡Ğ²ÑĞ·Ğ¸
  episodeProgress   EpisodeProgress[]
  
  @@unique([userId, investigationId])
  @@index([userId])
  @@index([investigationId, status])
}

enum InvestigationStatus {
  NOT_STARTED       // ĞĞµ Ğ½Ğ°Ñ‡Ğ°Ñ‚Ğ¾
  IN_PROGRESS       // Ğ’ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ
  COMPLETED         // Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾ (Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚Ğ¾)
  FAILED            // ĞŸÑ€Ğ¾Ğ²Ğ°Ğ»ĞµĞ½Ğ¾ (Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€)
}

// â•â•â• ĞŸĞ ĞĞ“Ğ Ğ•Ğ¡Ğ¡ ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¯ ĞŸĞ Ğ­ĞŸĞ˜Ğ—ĞĞ”Ğ£ â•â•â•
model EpisodeProgress {
  id                    Int       @id @default(autoincrement())
  
  investigationProgressId Int
  investigationProgress   InvestigationProgress @relation(fields: [investigationProgressId], references: [id], onDelete: Cascade)
  
  episodeId             Int
  episode               InvestigationEpisode @relation(fields: [episodeId], references: [id], onDelete: Cascade)
  
  // Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
  status                EpisodeStatus @default(NOT_STARTED)
  score                 Int       @default(0)
  
  // Ğ”Ğ»Ñ ÑÑĞ¶ĞµÑ‚Ğ½Ñ‹Ñ… ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ğ¾Ğ² â€” Ğ²Ñ‹Ğ±Ğ¾Ñ€Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  choices               Json?                  // { "choice1": "A", "choice2": "B" }
  
  // Ğ”Ğ»Ñ Ğ´Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² â€” Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹
  answers               Json?                  // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹
  
  // Ğ’Ñ€ĞµĞ¼Ñ
  startedAt             DateTime  @default(now())
  completedAt           DateTime?
  timeSpentSeconds      Int       @default(0)
  
  @@unique([investigationProgressId, episodeId])
  @@index([episodeId])
}

enum EpisodeStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  SKIPPED
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DUELS SYSTEM (1v1 Quiz Battles)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Duel {
  id              String       @id @default(cuid())
  
  // Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¸
  challengerId    Int
  challenger      User         @relation("DuelChallenger", fields: [challengerId], references: [id])
  opponentId      Int
  opponent        User         @relation("DuelOpponent", fields: [opponentId], references: [id])
  
  // ĞšĞ²Ğ¸Ğ· Ğ´Ğ»Ñ Ğ´ÑƒÑĞ»Ğ¸
  quizId          Int
  quiz            Quiz         @relation(fields: [quizId], references: [id])
  
  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  status          DuelStatus   @default(PENDING)
  
  // Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ (Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ğ³Ñ€Ñ‹ â€” Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑÑÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Ğ¸Ğ· DuelAnswer)
  challengerScore Int?
  opponentScore   Int?
  winnerId        Int?         // null = Ğ½Ğ¸Ñ‡ÑŒÑ
  
  // ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹
  xpReward        Int          @default(50)   // XP Ğ¿Ğ¾Ğ±ĞµĞ´Ğ¸Ñ‚ĞµĞ»Ñ
  xpLoser         Int          @default(10)   // XP Ğ¿Ñ€Ğ¾Ğ¸Ğ³Ñ€Ğ°Ğ²ÑˆĞµĞ¼Ñƒ (ÑƒÑ‚ĞµÑˆĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹)
  
  // Liveblocks Room ID
  roomId          String?      @unique        // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ
  
  // Ğ’Ñ€ĞµĞ¼Ñ
  createdAt       DateTime     @default(now())
  expiresAt       DateTime                    // 24h Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¸Ñ
  acceptedAt      DateTime?                   // ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ°
  startedAt       DateTime?                   // ĞšĞ¾Ğ³Ğ´Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°ÑÑŒ Ğ¸Ğ³Ñ€Ğ°
  finishedAt      DateTime?                   // ĞšĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ğ»Ğ°ÑÑŒ
  
  // ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² (Ğ´Ğ»Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ğ¾Ğ¹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸)
  answers         DuelAnswer[]
  
  @@index([challengerId, status])
  @@index([opponentId, status])
  @@index([status, expiresAt])
}

// â•â•â• ĞĞ¢Ğ’Ğ•Ğ¢Ğ« Ğ˜Ğ“Ğ ĞĞšĞĞ’ Ğ’ Ğ”Ğ£Ğ­Ğ›Ğ˜ (Ğ´Ğ»Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ğ¾Ğ¹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸) â•â•â•
// ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ Ñ‡Ğ¸Ñ‚ĞµÑ€ÑÑ‚Ğ²Ğ°
model DuelAnswer {
  id              Int          @id @default(autoincrement())
  
  duelId          String
  duel            Duel         @relation(fields: [duelId], references: [id], onDelete: Cascade)
  
  userId          Int                         // ĞšÑ‚Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»
  questionIndex   Int                         // Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° (0-based)
  optionId        Int?                        // ID Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ° (null = Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚)
  isCorrect       Boolean                     // ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ»Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚
  timeSpentMs     Int                         // Ğ’Ñ€ĞµĞ¼Ñ Ğ½Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ² Ğ¼Ñ
  
  createdAt       DateTime     @default(now())
  
  @@unique([duelId, userId, questionIndex])   // ĞĞ´Ğ¸Ğ½ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  @@index([duelId])
  @@index([duelId, userId])
}

enum DuelStatus {
  PENDING       // ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ğ¸Ñ
  DECLINED      // ĞÑ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ°
  ACCEPTED      // ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ°, Ğ¶Ğ´Ñ‘Ğ¼ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²
  IN_PROGRESS   // Ğ˜Ğ´Ñ‘Ñ‚ Ğ¸Ğ³Ñ€Ğ°
  FINISHED      // Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°
  EXPIRED       // Ğ˜ÑÑ‚ĞµĞºĞ»Ğ° (Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ½ÑĞ»Ğ¸ Ğ·Ğ° 24h)
  CANCELLED     // ĞÑ‚Ğ¼ĞµĞ½ĞµĞ½Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»ĞµĞ¼
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIT LOG SYSTEM
// Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model AuditLog {
  id              Int      @id @default(autoincrement())
  
  action          String                     // "quiz.create", "user.ban", "auth.login_failed", etc.
  adminId         Int?                       // ID Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° Ğ² Ğ‘Ğ” (null Ğ´Ğ»Ñ failed logins)
  adminTelegramId String?                    // Telegram ID Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° (null Ğ´Ğ»Ñ failed logins)
  
  targetType      String?                    // "user", "quiz", "tournament", etc.
  targetId        String?                    // ID Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°
  
  details         Json     @default("{}")    // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  
  ipAddress       String?                    // IP Ğ°Ğ´Ñ€ĞµÑ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°
  userAgent       String?                    // User-Agent Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
  
  createdAt       DateTime @default(now())
  
  @@index([action])
  @@index([adminTelegramId])
  @@index([targetType, targetId])
  @@index([createdAt(sort: Desc)])
}