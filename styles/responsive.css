/**
 * Responsive System - Адаптивный Layout для всех устройств и ОС
 * 
 * Использование:
 * - CSS переменные автоматически обновляются через useDeviceCSSVariables()
 * - Container queries для компонентов (@container)
 * - Адаптивные размеры шрифтов (clamp)
 * - Safe area поддержка для notch устройств
 */

/* ═══════════════════════════════════════════════════════════════════════════
   CSS CUSTOM PROPERTIES (переменные)
   ═══════════════════════════════════════════════════════════════════════════ */

:root {
  /* ═══ Safe Area Insets ═══ */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  
  /* ═══ Dynamic Viewport Units ═══ */
  --vh: 1vh;
  --dvh: 1dvh;
  --svh: 1svh;
  --lvh: 1lvh;
  
  /* ═══ Screen Size (обновляется через JS) ═══ */
  --screen-width: 100vw;
  --screen-height: 100dvh;
  --available-height: 100dvh;
  
  /* ═══ Keyboard ═══ */
  --keyboard-height: 0px;
  --is-keyboard-visible: 0;
  
  /* ═══ Device Type (mobile/tablet/desktop) ═══ */
  --device-type: mobile;
  
  /* ═══ Breakpoints ═══ */
  --bp-xs: 0px;
  --bp-sm: 640px;
  --bp-md: 768px;
  --bp-lg: 1024px;
  --bp-xl: 1280px;
  --bp-2xl: 1536px;
  
  /* ═══ Адаптивные Spacing ═══ */
  --space-xs: clamp(0.25rem, 0.5vw, 0.375rem);
  --space-sm: clamp(0.5rem, 1vw, 0.75rem);
  --space-md: clamp(0.75rem, 1.5vw, 1rem);
  --space-lg: clamp(1rem, 2vw, 1.5rem);
  --space-xl: clamp(1.5rem, 3vw, 2rem);
  --space-2xl: clamp(2rem, 4vw, 3rem);
  
  /* ═══ Адаптивные Font Sizes ═══ */
  --text-xs: clamp(0.625rem, 0.6rem + 0.1vw, 0.75rem);
  --text-sm: clamp(0.75rem, 0.7rem + 0.2vw, 0.875rem);
  --text-base: clamp(0.875rem, 0.8rem + 0.3vw, 1rem);
  --text-lg: clamp(1rem, 0.9rem + 0.4vw, 1.125rem);
  --text-xl: clamp(1.125rem, 1rem + 0.5vw, 1.25rem);
  --text-2xl: clamp(1.25rem, 1.1rem + 0.6vw, 1.5rem);
  --text-3xl: clamp(1.5rem, 1.3rem + 0.8vw, 1.875rem);
  --text-4xl: clamp(1.875rem, 1.5rem + 1.2vw, 2.25rem);
  --text-5xl: clamp(2.25rem, 1.8rem + 1.5vw, 3rem);
  
  /* ═══ Max Content Width ═══ */
  --max-content-width: min(100%, 480px);
  --max-content-width-lg: min(100%, 640px);
  --max-content-width-xl: min(100%, 1024px);
  
  /* ═══ Touch Target Sizes (минимум для доступности) ═══ */
  --touch-target-min: 44px;
  --touch-target-comfortable: 48px;
  
  /* ═══ Border Radius (адаптивный) ═══ */
  --radius-responsive: clamp(0.5rem, 1vw + 0.25rem, 1rem);
  --radius-responsive-lg: clamp(0.75rem, 1.5vw + 0.25rem, 1.5rem);
  --radius-responsive-xl: clamp(1rem, 2vw + 0.25rem, 2rem);
}

/* ═══════════════════════════════════════════════════════════════════════════
   CONTAINER QUERIES SETUP
   ═══════════════════════════════════════════════════════════════════════════ */

/* Контейнер для container queries */
.container-responsive,
[data-container] {
  container-type: inline-size;
  container-name: responsive;
}

/* Именованные контейнеры */
.container-card { container-name: card; container-type: inline-size; }
.container-section { container-name: section; container-type: inline-size; }
.container-page { container-name: page; container-type: inline-size; }

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE UTILITIES
   ═══════════════════════════════════════════════════════════════════════════ */

/* Safe Area Padding */
.safe-top { padding-top: var(--safe-top); }
.safe-bottom { padding-bottom: var(--safe-bottom); }
.safe-left { padding-left: var(--safe-left); }
.safe-right { padding-right: var(--safe-right); }
.safe-x { padding-left: var(--safe-left); padding-right: var(--safe-right); }
.safe-y { padding-top: var(--safe-top); padding-bottom: var(--safe-bottom); }
.safe-all { 
  padding: var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);
}

/* Full Height без клавиатуры */
.h-available { height: var(--available-height); }
.min-h-available { min-height: var(--available-height); }
.max-h-available { max-height: var(--available-height); }

/* Адаптивные отступы */
.p-responsive { padding: var(--space-md); }
.px-responsive { padding-left: var(--space-md); padding-right: var(--space-md); }
.py-responsive { padding-top: var(--space-md); padding-bottom: var(--space-md); }

.gap-responsive { gap: var(--space-md); }
.gap-responsive-sm { gap: var(--space-sm); }
.gap-responsive-lg { gap: var(--space-lg); }

/* Адаптивные шрифты */
.text-responsive-xs { font-size: var(--text-xs); }
.text-responsive-sm { font-size: var(--text-sm); }
.text-responsive { font-size: var(--text-base); }
.text-responsive-lg { font-size: var(--text-lg); }
.text-responsive-xl { font-size: var(--text-xl); }
.text-responsive-2xl { font-size: var(--text-2xl); }
.text-responsive-3xl { font-size: var(--text-3xl); }
.text-responsive-4xl { font-size: var(--text-4xl); }

/* Touch-friendly sizing */
.touch-target { 
  min-width: var(--touch-target-min); 
  min-height: var(--touch-target-min);
}
.touch-target-comfortable { 
  min-width: var(--touch-target-comfortable); 
  min-height: var(--touch-target-comfortable);
}

/* Max width containers */
.max-w-content { max-width: var(--max-content-width); margin-inline: auto; }
.max-w-content-lg { max-width: var(--max-content-width-lg); margin-inline: auto; }
.max-w-content-xl { max-width: var(--max-content-width-xl); margin-inline: auto; }

/* ═══════════════════════════════════════════════════════════════════════════
   CONTAINER QUERY BREAKPOINTS
   ═══════════════════════════════════════════════════════════════════════════ */

/* Пример использования:
   @container responsive (min-width: 400px) {
     .card-title { font-size: 1.25rem; }
   }
*/

/* Small container (< 300px) */
@container responsive (max-width: 299px) {
  .cq-compact { display: none; }
  .cq-title { font-size: var(--text-sm); }
  .cq-gap { gap: var(--space-xs); }
}

/* Medium container (300-500px) */
@container responsive (min-width: 300px) and (max-width: 499px) {
  .cq-title { font-size: var(--text-base); }
  .cq-gap { gap: var(--space-sm); }
}

/* Large container (500px+) */
@container responsive (min-width: 500px) {
  .cq-title { font-size: var(--text-lg); }
  .cq-gap { gap: var(--space-md); }
  .cq-grid-2 { grid-template-columns: repeat(2, 1fr); }
}

/* Extra Large container (700px+) */
@container responsive (min-width: 700px) {
  .cq-grid-3 { grid-template-columns: repeat(3, 1fr); }
  .cq-grid-4 { grid-template-columns: repeat(4, 1fr); }
}

/* ═══════════════════════════════════════════════════════════════════════════
   DEVICE-SPECIFIC STYLES
   ═══════════════════════════════════════════════════════════════════════════ */

/* iOS-specific fixes */
[data-os="ios"] {
  /* Prevent iOS bounce scroll */
  overscroll-behavior: none;
  
  /* Fix for 100vh on iOS */
  --real-vh: calc(var(--screen-height) / 100);
}

/* iOS notch support */
@supports (padding-top: env(safe-area-inset-top)) {
  [data-os="ios"] .header-safe {
    padding-top: calc(var(--safe-top) + 0.5rem);
  }
  
  [data-os="ios"] .footer-safe {
    padding-bottom: calc(var(--safe-bottom) + 0.5rem);
  }
}

/* Android-specific */
[data-os="android"] {
  /* Android navigation bar */
  --android-nav-height: 48px;
}

/* Desktop-specific */
[data-device="desktop"] {
  /* Hover states только на десктопе */
  --hover-opacity: 0.8;
  --hover-scale: 1.02;
}

/* Disable hover on touch devices */
[data-device="mobile"],
[data-device="tablet"] {
  --hover-opacity: 1;
  --hover-scale: 1;
}

/* ═══════════════════════════════════════════════════════════════════════════
   KEYBOARD VISIBILITY HANDLING
   ═══════════════════════════════════════════════════════════════════════════ */

/* Когда клавиатура видна */
html:has([data-keyboard-visible="true"]),
[data-keyboard-visible="true"] {
  /* Уменьшаем padding снизу */
  --safe-bottom: 0px;
}

/* Скрываем элементы при клавиатуре */
.hide-on-keyboard {
  transition: opacity 0.2s, transform 0.2s;
}

html:has([data-keyboard-visible="true"]) .hide-on-keyboard {
  opacity: 0;
  pointer-events: none;
  transform: translateY(20px);
}

/* ═══════════════════════════════════════════════════════════════════════════
   ORIENTATION HANDLING
   ═══════════════════════════════════════════════════════════════════════════ */

/* Portrait mode */
@media (orientation: portrait) {
  :root {
    --content-direction: column;
    --sidebar-position: bottom;
  }
}

/* Landscape mode */
@media (orientation: landscape) {
  :root {
    --content-direction: row;
    --sidebar-position: left;
  }
  
  /* На мобильных в landscape - ограничиваем высоту */
  [data-device="mobile"] {
    --max-content-width: 100%;
  }
}

/* ═══════════════════════════════════════════════════════════════════════════
   ACCESSIBILITY & REDUCED MOTION
   ═══════════════════════════════════════════════════════════════════════════ */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* High contrast mode */
@media (prefers-contrast: high) {
  :root {
    --border-width: 2px;
  }
}

/* ═══════════════════════════════════════════════════════════════════════════
   PRINT STYLES
   ═══════════════════════════════════════════════════════════════════════════ */

@media print {
  .no-print { display: none !important; }
  
  :root {
    --safe-top: 0;
    --safe-bottom: 0;
    --safe-left: 0;
    --safe-right: 0;
  }
}

