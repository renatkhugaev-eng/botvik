import { createStory, type Story } from "@/lib/story-engine";

/**
 * ══════════════════════════════════════════════════════════════════════════════
 * ДЕЛО ЛЕСОПОЛОСА - Интерактивное расследование
 * ══════════════════════════════════════════════════════════════════════════════
 */

export const lesopolosaStory: Story = createStory({
  id: "lesopolosa",
  title: "Дело Лесополоса",
  startScene: "prologue",
  variables: {
    objectivity: 0,
    cluesFound: 0,
  },
  scenes: {
    // ═══════════════════════════════════════════════════════════════════════
    // ПРОЛОГ
    // ═══════════════════════════════════════════════════════════════════════
    prologue: {
      id: "prologue",
      paragraphs: [
        "═══════════════════════════════════════════════════════════════",
        "22 ДЕКАБРЯ 1978 ГОДА",
        "Город Шахты, Ростовская область",
        "═══════════════════════════════════════════════════════════════",
        "",
        "Снег. Мороз. Последние дни перед Новым годом.",
        "",
        "9-летняя Лена возвращается из школы. До дома — 15 минут пешком. Обычный маршрут мимо автобусной остановки.",
        "",
        "Она так и не дошла.",
      ],
      mood: "dark",
      next: "discovery",
    },

    discovery: {
      id: "discovery",
      paragraphs: [
        "Через два дня тело находят в лесополосе у реки Грушевка.",
        "",
        "Вас вызывают на место преступления. Вы — следователь Михаил Фетисов, 35 лет стажа. За плечами сотни дел.",
        "",
        "Дежурный передаёт: «Там страшно, товарищ следователь. Даже опера в шоке.»",
      ],
      mood: "tense",
      next: "crime_scene",
    },

    // ═══════════════════════════════════════════════════════════════════════
    // МЕСТО ПРЕСТУПЛЕНИЯ
    // ═══════════════════════════════════════════════════════════════════════
    crime_scene: {
      id: "crime_scene",
      paragraphs: [
        "Лесополоса. Сугробы. Жёлтая лента ограждения.",
        "",
        "Тело накрыто брезентом. Вокруг — следователи, эксперты, местный участковый. Все молчат. Кто-то курит, отвернувшись.",
        "",
        "Судмедэксперт Ольга Николаевна подходит к вам. Её руки дрожат.",
        "",
        "«Михаил Сергеевич, за 20 лет работы... я такого не видела.»",
      ],
      mood: "horror",
      choices: [
        { id: "examine_body", text: "Осмотреть тело лично", next: "body_examination" },
        { id: "expert_report", text: "Выслушать отчёт эксперта", next: "expert_speaks" },
        { id: "search_area", text: "Осмотреть периметр", next: "perimeter_search" },
      ],
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ВЕТКА: ОСМОТР ТЕЛА
    // ═══════════════════════════════════════════════════════════════════════
    body_examination: {
      id: "body_examination",
      paragraphs: [
        "Вы поднимаете брезент.",
        "",
        "...",
        "",
        "Множественные колото-резаные раны. Не менее 20. Грудь, живот, спина.",
        "Характерные повреждения глаз — выколоты.",
        "Следы сексуального насилия.",
        "Частичное удаление внутренних органов.",
        "",
        "Это не убийство в состоянии аффекта. Это... ритуал.",
        "",
        "📝 УЛИКА: Характер ранений указывает на организованного убийцу",
      ],
      mood: "horror",
      tags: ["clue:organized_killer", "score:10"],
      next: "first_lead",
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ВЕТКА: ОТЧЁТ ЭКСПЕРТА
    // ═══════════════════════════════════════════════════════════════════════
    expert_speaks: {
      id: "expert_speaks",
      speaker: "Эксперт",
      paragraphs: [
        "Ольга Николаевна читает по блокноту, стараясь не смотреть на брезент:",
        "",
        "«Жертва — девочка 9 лет. Смерть наступила 22 декабря, между 16:00 и 18:00.",
        "Причина смерти — множественные колото-резаные ранения.",
        "Орудие — нож с лезвием около 15 сантиметров.",
        "",
        "Обнаружены следы сексуального насилия. Частичное изъятие органов.",
        "",
        "Группа крови на месте преступления — IV (AB), резус положительный.»",
        "",
        "Она закрывает блокнот. «Убийца — не случайный. Он знал, что делает.»",
        "",
        "📝 УЛИКА: Группа крови — IV (AB)",
      ],
      mood: "tense",
      tags: ["clue:blood_type_ab", "score:10"],
      next: "first_lead",
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ВЕТКА: ПЕРИМЕТР
    // ═══════════════════════════════════════════════════════════════════════
    perimeter_search: {
      id: "perimeter_search",
      paragraphs: [
        "Вы обходите место преступления. Снег уже частично скрыл следы, но кое-что видно:",
        "",
        "• Следы волочения от просёлочной дороги — тело принесли сюда",
        "• Отпечатки мужских ботинок, размер 43-44",
        "• Смятая газета «Молот» от 20 декабря",
        "• В 200 метрах — железнодорожная ветка",
        "",
        "Участковый: «Тут недалеко станция Персиановка. Электрички ходят в Ростов и Шахты.»",
        "",
        "📝 УЛИКА: Близость к железной дороге",
      ],
      mood: "tense",
      tags: ["clue:railway_connection", "score:10"],
      next: "first_lead",
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ПЕРВАЯ ЗАЦЕПКА
    // ═══════════════════════════════════════════════════════════════════════
    first_lead: {
      id: "first_lead",
      paragraphs: [
        "Вы записываете первые наблюдения в блокнот.",
        "",
        "Старший оперуполномоченный Горюнов подходит:",
        "",
        "«Товарищ следователь, есть информация. Соседка видела Лену у автобусной остановки около 16:00. С ней разговаривал какой-то мужчина. Высокий, худой, в очках. На вид лет 40-50, в сером плаще.»",
        "",
        "Ещё один опер добавляет:",
        "«И есть зацепка. В 500 метрах отсюда живёт Александр Кравченко, 25 лет. Ранее судим за изнасилование несовершеннолетней. Освободился полгода назад.»",
      ],
      mood: "tense",
      choices: [
        { 
          id: "focus_kravchenko", 
          text: "Сосредоточиться на Кравченко — судимость говорит сама за себя", 
          next: "kravchenko_path",
          effects: { objectivity: -20 }
        },
        { 
          id: "focus_witness", 
          text: "Искать мужчину в очках — свидетель видел именно его", 
          next: "witness_path",
          effects: { objectivity: 10 }
        },
        { 
          id: "investigate_both", 
          text: "Проверить оба направления параллельно", 
          next: "both_paths",
          effects: { objectivity: 20 }
        },
      ],
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ПУТЬ КРАВЧЕНКО (ПЛОХОЙ)
    // ═══════════════════════════════════════════════════════════════════════
    kravchenko_path: {
      id: "kravchenko_path",
      paragraphs: [
        "Вы принимаете решение: рецидивист — главный подозреваемый.",
        "",
        "Оперативники задерживают Александра Кравченко в тот же вечер. Он растерян, испуган. Кричит, что ни в чём не виноват.",
        "",
        "Допросы идут несколько дней. Давление нарастает. Начальство требует результат — дело на контроле в обкоме.",
        "",
        "Наконец, Кравченко «признаётся».",
        "",
        "Но есть проблема: его группа крови — III (B). На месте преступления — IV (AB).",
        "",
        "Эксперт пожимает плечами: «Может, загрязнение образца...»",
        "",
        "⚠️ Несовпадение группы крови игнорируется.",
        "",
        "Дело закрыто. Кравченко приговорён к расстрелу.",
      ],
      mood: "dark",
      tags: ["score:-50"],
      next: "tragedy_ending",
    },

    tragedy_ending: {
      id: "tragedy_ending",
      paragraphs: [
        "════════════════════════════════════════",
        "1983 год. Кравченко расстрелян.",
        "════════════════════════════════════════",
        "",
        "Вы закрываете папку с делом. Справедливость восторжествовала?",
        "",
        "...",
        "",
        "1984 год. Новое тело. Те же признаки. Те же ранения глаз.",
        "1985 год. Ещё пять тел.",
        "1986 год. Семь.",
        "",
        "💀 ПОСЛЕДСТВИЕ: Ваш выбор привёл к гибели невиновного.",
        "Настоящий убийца на свободе. А невиновный — мёртв.",
        "",
        "════════════════════════════════════════",
        "ЭПИЗОД ЗАВЕРШЁН — Плохая концовка",
        "════════════════════════════════════════",
      ],
      mood: "horror",
      tags: ["ending:bad", "score:-50"],
      isEnd: true,
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ПУТЬ СВИДЕТЕЛЯ
    // ═══════════════════════════════════════════════════════════════════════
    witness_path: {
      id: "witness_path",
      paragraphs: [
        "Вы решаете искать мужчину в очках. Судимость Кравченко — косвенная улика, не доказательство.",
        "",
        "Опрос свидетелей:",
        "• Соседка: «Высокий, худой, интеллигентный. Очки в роговой оправе.»",
        "• Продавщица киоска: «Видела его раньше у станции. Часто ездит на электричках.»",
        "• Старик на лавочке: «Одет хорошо, как начальник какой-то. Портфель нёс.»",
        "",
        "Описание не совпадает с Кравченко — тот молодой, без очков, рабочей внешности.",
        "",
        "Но начальство давит: «У нас есть судимый рецидивист! Чего ещё искать?»",
        "",
        "Вы стоите перед выбором.",
      ],
      mood: "tense",
      tags: ["clue:witness_description", "score:10"],
      choices: [
        { 
          id: "yield", 
          text: "Уступить давлению — арестовать Кравченко", 
          next: "yield_ending",
          effects: { objectivity: -30 }
        },
        { 
          id: "resist", 
          text: "Настоять на своём — искать мужчину в очках", 
          next: "good_ending",
          effects: { objectivity: 30 }
        },
      ],
    },

    yield_ending: {
      id: "yield_ending",
      paragraphs: [
        "Вы сдаётесь. Система сильнее.",
        "",
        "Кравченко арестован. Признание получено. Дело закрыто.",
        "В 1983 году его расстреляют.",
        "",
        "А в 1984 году появится новое тело с теми же признаками...",
        "",
        "💀 ПОСЛЕДСТВИЕ: Невиновный казнён.",
        "",
        "════════════════════════════════════════",
        "ЭПИЗОД ЗАВЕРШЁН — Плохая концовка",
        "════════════════════════════════════════",
      ],
      mood: "dark",
      tags: ["ending:bad", "score:-30"],
      isEnd: true,
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ОБА ПУТИ (ОПТИМАЛЬНЫЙ)
    // ═══════════════════════════════════════════════════════════════════════
    both_paths: {
      id: "both_paths",
      paragraphs: [
        "Вы решаете не спешить. Оба направления заслуживают проверки.",
        "",
        "НАПРАВЛЕНИЕ 1: Кравченко",
        "• Судимость за изнасилование — факт",
        "• Живёт рядом — факт",
        "• НО: группа крови III (B), на месте — IV (AB)",
        "• НО: не соответствует описанию свидетеля",
        "",
        "НАПРАВЛЕНИЕ 2: Мужчина в очках",
        "• Соответствует описанию свидетеля",
        "• Интеллигентный вид, портфель",
        "• Связь с железной дорогой",
        "• НО: никаких конкретных данных",
        "",
        "Вам нужно больше информации.",
      ],
      mood: "tense",
      tags: ["score:20"],
      choices: [
        { id: "interrogate", text: "Допросить Кравченко — проверить алиби", next: "interrogation" },
        { id: "station", text: "Организовать наблюдение на станции", next: "station_watch" },
        { id: "forensics", text: "Углубить криминалистическую экспертизу", next: "forensics" },
      ],
    },

    interrogation: {
      id: "interrogation",
      speaker: "Подозреваемый",
      paragraphs: [
        "Кравченко доставлен на допрос. Он нервничает, но не агрессивен.",
        "",
        "«Я ничего не делал! Да, я сидел, но я изменился! 22-го числа я был дома, жена подтвердит!»",
        "",
        "Вы проверяете алиби. Жена подтверждает. Соседи тоже видели его дома.",
        "",
        "Но прокурор давит: «Рецидивист врёт. Жена покрывает. Добейся признания.»",
        "",
        "Вы смотрите на Кравченко. Молодой. Испуганный. Не похож на хладнокровного убийцу.",
        "",
        "А группа крови... не совпадает.",
        "",
        "📝 ЗАМЕТКА: Алиби Кравченко подтверждено. Группа крови не совпадает.",
      ],
      mood: "tense",
      tags: ["clue:alibi_confirmed", "score:15"],
      next: "good_ending",
    },

    station_watch: {
      id: "station_watch",
      paragraphs: [
        "Вы организуете скрытое наблюдение на станции Персиановка.",
        "",
        "Три дня ничего. На четвёртый — интересное.",
        "",
        "Мужчина лет 45-50. Высокий, худой. Очки в роговой оправе. Серый плащ. Несёт портфель. Покупает билет на электричку до Ростова.",
        "",
        "Что-то в нём настораживает. Он слишком внимательно смотрит на людей. Особенно — на молодых женщин и детей.",
        "",
        "Оперативник шепчет: «Записал его. Выходил, когда пришла электричка. Сел в третий вагон.»",
        "",
        "📝 ЗАМЕТКА: Замечен мужчина, соответствующий описанию. Связь с ж/д подтверждена.",
      ],
      mood: "tense",
      tags: ["clue:suspect_spotted", "score:20"],
      next: "good_ending",
    },

    forensics: {
      id: "forensics",
      speaker: "Эксперт",
      paragraphs: [
        "Вы заказываете расширенную экспертизу.",
        "",
        "Результаты:",
        "• Группа крови на месте — IV (AB)",
        "• Группа слюны (на одежде жертвы) — II (A)",
        "• Волосы — русые, седеющие",
        "",
        "Эксперт озадачен: «Странно. Обычно группа крови и выделений совпадает. Но тут... либо два человека, либо...»",
        "",
        "Вы: «Либо что?»",
        "",
        "Эксперт: «Есть редкий феномен — парадоксальное выделительство. У человека группа крови одна, а в выделениях определяется другая. Редкость — 1 случай на 10 000.»",
        "",
        "📝 УЛИКА: Возможно парадоксальное выделительство. Это объясняет несовпадение.",
      ],
      mood: "tense",
      tags: ["clue:paradoxical_secretion", "score:25"],
      next: "good_ending",
    },

    // ═══════════════════════════════════════════════════════════════════════
    // ХОРОШАЯ КОНЦОВКА
    // ═══════════════════════════════════════════════════════════════════════
    good_ending: {
      id: "good_ending",
      paragraphs: [
        "Дело становится сложнее. Но вы на правильном пути.",
        "",
        "Кравченко арестован другими следователями. Вы не можете этому помешать.",
        "Но вы знаете: рано или поздно правда выйдет наружу.",
        "",
        "Дома, в столе, появляется отдельная папка. Без грифа. Без номера дела. Просто «ЗАПИСИ».",
        "",
        "Каждое новое убийство — новый лист. Даты, места, подробности.",
        "Вы ищете закономерности. Строите профиль.",
        "",
        "✅ ПОСЛЕДСТВИЕ: Вы сохранили объективность. Ваши записи пригодятся.",
        "",
        "════════════════════════════════════════",
        "ЭПИЗОД 1 ЗАВЕРШЁН",
        "",
        "Собранные улики сохранены.",
        "Продолжение следует...",
        "════════════════════════════════════════",
      ],
      mood: "hope",
      tags: ["ending:good", "score:50"],
      isEnd: true,
    },
  },
});

export default lesopolosaStory;
